---
import Baselayout from "../../layouts/BaseLayout.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";
import ExpCard from "../../components/ExpCard.astro";
import code from "../../images/code-xml.svg";
import laugh from "../../images/laugh.svg";
import tv from "../../images/tv-minimal-play.svg";

const lang = getLangFromUrl(Astro.url) as "sk" | "cz" | "en" | "la";
const t = useTranslations(lang);

const pageTitle = "Skúsenosti - Michal Dekýš";
const description = t("description.skusenosti");
const ogLocale = "sk_SK";
const ogTitle = "Michal Dekýš - Skúsenosti";
const ogImage = "";
const ogUrl = Astro.url.href;
const ogImageAlt = "Logo Michala Dekýša";
const headerTitle = t("page.skusenosti");

const navItems = [
  { key: "o-mne", label: t("nav.about"), href: "/en/o-mne" },
  { key: "portfolio", label: t("nav.portfolio"), href: "/en/portfolio" },
  { key: "index", label: t("nav.home"), href: "/en/index" },
];
---

<Baselayout
  pageTitle={pageTitle}
  description={description}
  ogLocale={ogLocale}
  ogTitle={ogTitle}
  ogImage={ogImage}
  ogUrl={ogUrl}
  ogDescription={description}
  ogImageAlt={ogImageAlt}
  headerTitle={headerTitle}
  navItems={navItems}
>
  <div class="relative mt-8 h-[600px] overflow-hidden" id="exp-cards-scroll">
    <div class="exp-card absolute top-0 w-full" style="z-index:4;">
      <ExpCard
        svgUrl={tv.src}
        svgLabel="tv"
        datum="2018 - 2020"
        title={t("tvorba.rtb")}
        firma="Publicis Groupe"
        description={t("description.rtb")}
      />
    </div>
    <div class="exp-card absolute top-25 w-full" style="z-index:3;">
      <ExpCard
        svgUrl={laugh.src}
        svgLabel="laugh"
        datum="2020 - 2023"
        title={t("rodicovska.dovolenka")}
        firma="DeKiss Family"
        description={t("description.dovolenka")}
      />
    </div>
    <div class="exp-card absolute top-50 w-full" style="z-index:2;">
      <ExpCard
        svgUrl={laugh.src}
        svgLabel="laugh"
        datum="2023 - 2024"
        title={t("kurzy.spoluprace")}
        firma={t("centra.digital")}
        description={t("description.kurzy")}
      />
    </div>
    <div class="exp-card absolute top-75 w-full" style="z-index:1;">
      <ExpCard
        svgUrl={code.src}
        svgLabel="code"
        datum="2024 - doteraz"
        title={t("tvorba.webu")}
        firma="DeKiss"
        description={t("description.webstranky")}
      />
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const cards = document.querySelectorAll(".exp-card");
      let active = 0;
      function updateZIndex(idx: number) {
        cards.forEach((card, i) => {
          (card as HTMLElement).style.zIndex = (cards.length - Math.abs(idx - i)).toString();
          (card as HTMLElement).style.opacity = "1";
          (card as HTMLElement).style.transform = i === idx ? "scale(1)" : "scale(0.95)";
          (card as HTMLElement).style.transition = "all 0.5s";
        });
        active = idx;
      };

      // wheel and touch scroll
      const expCardsScroll = document.getElementById("exp-cards-scroll");
      if (expCardsScroll) {
        expCardsScroll.addEventListener("wheel", function (e) {
          if (e.deltaY > 0 && active < cards.length - 1) {
            updateZIndex(active + 1);
          } else if (e.deltaY < 0 && active > 0) {
            updateZIndex(active - 1);
          }
        });

        // touch scroll
        let touchStartY: number | null = null;
        expCardsScroll.addEventListener("touchstart", function (e) {
          touchStartY = e.touches[0].clientY;
        });
        
        expCardsScroll.addEventListener("touchend", function (e) {
          if (touchStartY === null) return;
          const touchEndY = e.changedTouches[0].clientY;
          const deltaY = touchStartY - touchEndY;
          if (deltaY > 30 && active < cards.length - 1) {
            updateZIndex(active + 1);
          } else if (deltaY < -30 && active > 0) {
            updateZIndex(active - 1);
          }
          touchStartY = null;
        });
      }
      updateZIndex(cards.length - 1);
    });
  </script>
</Baselayout>
